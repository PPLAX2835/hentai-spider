<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>detail</title>
    <link href="../js/layui/css/layui.css" rel="stylesheet">
</head>
<body>

    <div class="layui-row">

        <div class="layui-row">
            <legend id="aid"></legend>
            <legend id="aname"></legend>
            <table class="layui-hide" id="platform-artist-table" lay-filter="platform-artist-table"></table>
        </div>

    </div>


    <script src="../js/layui/layui.js"></script>
    <script src="../js/utils/UrlUtils.js"></script>

    <script>
        // 获得作者id，昵称
        let id = getUrlParams(window.location.href).id;
        let name = getUrlParams(window.location.href).name;

        let $ = layui.$;
        $('#aid').text("ID：" + id);
        $("#aname").text("name：" + name)


        layui.use('table', function () {
            var table = layui.table

            table.render({
                elem: '#platform-artist-table', // 指定table模板  也就是上方的table DOM
                height: 400, // 指定Table模板的高度
                url: '/api/platformArtist/' + id, // 对应的数据接口，这边直接是请求的json文件
                cellMinWidth: 120,
                cols: [[
                    // {checkbox: true, fixed: true},
                    {field:'platformArtistId', title: 'platformArtistId', width: 30, sort: true, fixed: true},
                    {field:'platformArtistName', edit:'text', title: '该平台昵称', minWidth: 50, sort: true, fixed: true},
                    {field:'homepageUrl', edit:'text', title: '该平台主页', minWidth: 80, sort: true, fixed: true},
                    {field:'platformName', title: '平台名', minWidth: 80, sort: true, fixed: true},
                    {field:'platformUrl', title: '平台地址', minWidth: 80, sort: true, fixed: true},
                    {fixed: 'right', title: '操作', minWidth: 80, align: 'center', toolbar: '#platform-artist-table-theads-tool'}
                ]]
            });


            //行单击事件（双击事件为：rowDouble）
            table.on('tool(platform-artist-table)', function(obj){
                if(obj.event === 'delete'){
                    layer.confirm('真的删除行么', function(index){
                        obj.del();
                        layer.close(index);
                    });
                }
            });


            // 行编辑事件
            table.on('edit(platform-artist-table)', function(obj){
                let id = obj.data.platformArtistId;
                let newPlatformArtistName = obj.data.platformArtistName;
                let newHomepageUrl = obj.data.homepageUrl;

                console.log(id)
                console.log(newPlatformArtistName)
                console.log(newHomepageUrl)

                var formdata = new FormData();

                formdata.append("platformArtistName", newPlatformArtistName);
                formdata.append("platformUrl", newHomepageUrl);

                $.ajax({
                    type: "PUT",
                    url: '/api/platformArtist/' + id,
                    processData:false,
                    contentType:false,
                    data: formdata,
                    success: function(res) {
                        layer.msg(res);
                    }
                });

            });

        })
    </script>

    <script type="text/html" id="platform-artist-table-theads-tool">
        <div class="layui-btn-container">
            <a type="button" class="layui-btn layui-btn-primary layui-btn-sm" lay-event="delete">删除</a>
        </div>
    </script>
</body>
</html>